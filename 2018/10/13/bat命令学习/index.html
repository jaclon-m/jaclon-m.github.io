<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>bat命令学习 - Jacklon&#039;s Blog</title><meta description="基础部分一、介绍 批处理文件是一个“.bat”结尾的文本文件，这个文件的每一行都是一条DOS命令。可以使用任何文本文件编辑工具创建和修改。 批处理是一种简单的程序，可以用 if 和 goto 来控制流程，也可以使用 for 循环。 批处理的编程能力远不如C语言等编程语言，也十分不规范。 每个编写好的批处理文件都相当于一个DOS的外部命令，把它所在的目录放到DOS搜索路径(path)中，即可在任意位"><meta property="og:type" content="blog"><meta property="og:title" content="bat命令学习"><meta property="og:url" content="http://59.110.153.50/2018/10/13/bat%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/"><meta property="og:site_name" content="Jacklon&#039;s Blog"><meta property="og:description" content="基础部分一、介绍 批处理文件是一个“.bat”结尾的文本文件，这个文件的每一行都是一条DOS命令。可以使用任何文本文件编辑工具创建和修改。 批处理是一种简单的程序，可以用 if 和 goto 来控制流程，也可以使用 for 循环。 批处理的编程能力远不如C语言等编程语言，也十分不规范。 每个编写好的批处理文件都相当于一个DOS的外部命令，把它所在的目录放到DOS搜索路径(path)中，即可在任意位"><meta property="og:image" content="http://59.110.153.50/img/og_image.png"><meta property="article:published_time" content="2018-10-13T06:43:07.000Z"><meta property="article:modified_time" content="2020-06-15T14:40:08.872Z"><meta property="article:author" content="Jacklon"><meta property="article:tag" content="bat命令"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://59.110.153.50/2018/10/13/bat%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/"},"headline":"Jacklon's Blog","image":["http://59.110.153.50/img/og_image.png"],"datePublished":"2018-10-13T06:43:07.000Z","dateModified":"2020-06-15T14:40:08.872Z","author":{"@type":"Person","name":"Jacklon"},"description":"基础部分一、介绍 批处理文件是一个“.bat”结尾的文本文件，这个文件的每一行都是一条DOS命令。可以使用任何文本文件编辑工具创建和修改。 批处理是一种简单的程序，可以用 if 和 goto 来控制流程，也可以使用 for 循环。 批处理的编程能力远不如C语言等编程语言，也十分不规范。 每个编写好的批处理文件都相当于一个DOS的外部命令，把它所在的目录放到DOS搜索路径(path)中，即可在任意位"}</script><link rel="canonical" href="http://59.110.153.50/2018/10/13/bat%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?65d4748cd6417633e46d97986b1808cf";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Jacklon&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/jaclon-m"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Katalog" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-10-13T06:43:07.000Z" title="2018-10-13T06:43:07.000Z">2018-10-13</time><span class="level-item"><a class="link-muted" href="/categories/%E7%94%9F%E4%BA%A7%E5%B7%A5%E5%85%B7/">生产工具</a></span><span class="level-item">41 minutes lesen (Über 6119 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile">bat命令学习</h1><div class="content"><h2 id="基础部分"><a href="#基础部分" class="headerlink" title="基础部分"></a>基础部分</h2><h3 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h3><ol>
<li>批处理文件是一个“.bat”结尾的文本文件，这个文件的每一行都是一条DOS命令。可以使用任何文本文件编辑工具创建和修改。</li>
<li>批处理是一种简单的程序，可以用 if 和 goto 来控制流程，也可以使用 for 循环。</li>
<li>批处理的编程能力远不如C语言等编程语言，也十分不规范。</li>
<li>每个编写好的批处理文件都相当于一个DOS的外部命令，把它所在的目录放到DOS搜索路径(path)中，即可在任意位置运行。</li>
<li>C:\AUTOEXEC.BAT 是每次系统启动时都会自动运行的，可以将每次启动时都要运行的命令放入该文件中。</li>
<li>大小写不敏感(命令符忽略大小写)</li>
<li>批处理的文件扩展名为 .bat 或 .cmd。</li>
<li>在命令提示下键入批处理文件的名称，或者双击该批处理文件，系统就会调用cmd.exe来运行该文件。</li>
</ol>
<a id="more"></a>

<h3 id="二、参数"><a href="#二、参数" class="headerlink" title="二、参数"></a>二、参数</h3><ol>
<li><p>系统参数</p>
<pre><code>%SystemRoot%   ===    C:\WINDOWS    (%windir% 同样)
%ProgramFiles% ===    C:\Program Files
%USERPROFILE%  ===    C:\Documents and Settings\Administrator  (子目录有“桌面”,“开始菜单”,“收藏夹”等)
%APPDATA%      ===    C:\Documents and Settings\Administrator\Application Data
%TEMP%         ===    C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp  (%TEM% 同样)
%APPDATA%      ===    C:\Documents and Settings\Administrator\Application Data
%OS%           ===    Windows_NT (系统)
%Path%         ===    %SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem  (原本的设置)
%HOMEDRIVE%    ===    C:   (系统盘)
%HOMEPATH%     ===    \Documents and Settings\Administrator

:: 枚举当前的环境变量
setlocal enabledelayedexpansion
FOR /F &quot;usebackq delims==&quot; %%i IN (`set`) DO @echo %%i    !%%i!</code></pre></li>
<li><p>传递参数给批处理文件<br>%[1-9]表示参数，参数是指在运行批处理文件时在文件名后加的以空格(或者Tab)分隔的字符串。<br>变量可以从%0到%9，%0表示批处理命令本身，其它参数字符串用 %1 到 %9 顺序表示。<br>Sample：</p>
<pre><code>call test2.bat &quot;hello&quot; &quot;haha&quot; (执行同目录下的“test2.bat”文件，并输入两个参数)
在“test2.bat”文件里写:
echo %1  (打印: &quot;hello&quot;)
echo %2  (打印: &quot;haha&quot;)
echo %0  (打印: test2.bat)
echo %19 (打印: &quot;hello&quot;9)</code></pre></li>
<li><p>批处理基本命令</p>
<ol>
<li><p>help命令(/?)<br>语法： 命令 /?<br>可显示此命令的帮助信息</p>
<pre><code>type /? &gt;&gt;tmp.txt  (把 type 命令的帮助信息写入到tmp.txt文件里)
help type  (显示跟“type /?”一样)</code></pre></li>
<li><p>echo命令<br>语法: echo [on|off] [message]<br>ECHO [ON | OFF]   打开回显或关闭回显功能。<br>ECHO  显示当前回显设置。<br>ECHO [message]显示信息。<br>echo off 表示在此语句后所有运行的命令都不显示命令行本身；默认是on，on时会显示如： C:\文件夹路径&gt;命令行。<br>在实际应用中我们会把这条命令和重定向符号( 也称为管道符号，一般用 &gt; &gt;&gt; ^ )结合来实现输入一些命令到特定格式的文件中。<br>sample1:</p>
<pre><code>F:\&gt;echo hello world
hello world

F:\&gt;echo on

F:\&gt;echo helloworld
helloworld

F:\&gt;echo off
echo helloworld
helloworld</code></pre><p>sample2:</p>
<pre><code>echo Windows Registry Editor Version 5.00 &gt; c:\setupreg.reg (此前还没有 setupreg.reg 这个文件)
echo &quot;SourcePath&quot;=&quot;D:\\Win2003\\&quot; &gt;&gt; c:\setupreg.reg   (追加内容进 setupreg.reg 这个文件)</code></pre></li>
<li><p>@命令<br>表示不显示@后面的命令，(在入侵过程中自然不能让对方看到你使用的命令啦)<br>@ 与 echo off 相象，但它是加在每个命令行的最前面，表示运行时不显示这一行的命令行(只能影响当前行)。</p>
<pre><code>@echo off  (此语句常用于开头，表示不显示所有的命令行信息，包括此句)
@echo please wait a minite...</code></pre></li>
<li><p>Rem命令<br>语法：Rem Message…<br>(小技巧：用::代替rem)<br>注释命令，在C语言中相当与/<em>…</em>/,它并不会被执行，只是起一个注释的作用，便于别人阅读和自己日后修改。</p>
</li>
<li><p>goto命令<br>语法：goto label (label是参数，指定所要转向的批处理程序中的行。)<br>指定跳转到标签行，找到标签行后，程序将处理从下一行开始的命令。<br>label标签的名字可以随便起，但是最好是有意义的，字母前必须加个冒号“:”来表示这个字母是标签。<br>goto命令就是根据这个冒号来<br>寻找下一步跳到到那里。经常与 if 配合使用，根据不同的条件来执行不同的命令组。</p>
</li>
<li><p>Pause 命令<br>会暂停批处理的执行并在屏幕上显示Press any key to continue…的提示，等待用户按任意键后继续<br>sample:</p>
<pre><code>@echo off
:begin
copy a:*.* d:\back
echo Please put a new disk into driver A
pause
goto begin</code></pre><p>在这个例子中，驱动器 A 中磁盘上的所有文件均复制到d:\back中。<br>显示的信息提示您将另一张磁盘放入驱动器 A 时，pause 命令会使程序挂起，以便您更换磁盘，然后按任意键再次复制。</p>
</li>
<li><p>call 命令<br>语法: call [[Drive:][Path] FileName [BatchParameters]] [:label [arguments]]<br>参数: [Drive:][Path] FileName  指定要调用的批处理程序的位置和名称。filename 参数必须具有 .bat 或 .cmd 扩展名。<br>调用另一个批处理程序，并且不终止父批处理程序。<br>如果不用call而直接调用别的批处理文件，那么执行完那个批处理文件后将无法返回当前文件并执行当前文件的后续命令。<br>call 命令接受用作调用目标的标签。如果在脚本或批处理文件外使用 call，它将不会在命令行起作用。</p>
<pre><code>call=&quot;%cd%\test2.bat&quot; haha kkk aaa    (调用指定目录下的 test2.bat，且输入3个参数给他)
call test2.bat arg1 arg2    (调用同目录下的 test2.bat，且输入2个参数给他)</code></pre><p>注：可以调用自身(死循环、递归)</p>
</li>
<li><p>start 命令<br>调用外部程序，所有的 DOS命令 和 命令行程序 都可以由 start命令 来调用。<br>常用参数：</p>
<ul>
<li><p>MIN 开始时窗口最小化</p>
</li>
<li><p>SEPARATE 在分开的空间内开始 16 位 Windows 程序</p>
</li>
<li><p>HIGH 在 HIGH 优先级类别开始应用程序</p>
</li>
<li><p>REALTIME 在 REALTIME 优先级类别开始应用程序</p>
</li>
<li><p>WAIT 启动应用程序并等候它结束</p>
</li>
<li><p>parameters 这些为传送到命令/程序的参数</p>
<pre><code>start /MIN test2.bat arg1 arg2    (调用同目录下的 test2.bat，且输入2个参数给他，且本窗口最小化)
e:\&quot;program files&quot;\极品列车时刻表\jpskb.exe  (文件路径名有空格时)</code></pre></li>
</ul>
</li>
<li><p>if else</p>
<ol>
<li><p>IF<br>语法: if [not] “参数” == “字符串” 待执行的命令<br>参数如果等于(not表示不等，下同)指定的字符串，则条件成立，运行命令，否则运行下一句。(注意是两个等号)</p>
<pre><code>if &quot;%1&quot; == &quot;a&quot; format a:
if {%1} == {} goto noparms</code></pre></li>
<li><p>if exist<br>语法: if [not] exist [路径]文件名 待执行的命令<br>如果有指定的文件，则条件成立，运行命令，否则运行下一句。</p>
<pre><code>if exist config.sys edit config.sys   (表示如果存在这文件，则编辑它)
if exist config.sys type config.sys   (表示如果存在这文件，则显示它的内容)</code></pre></li>
<li><p>if errorlevel number<br>语法: if [not] errorlevel &lt;数字&gt; 待执行的命令<br>如果程序返回值等于指定的数字，则条件成立，运行命令，否则运行下一句。(返回值必须按照从大到小的顺序排列)</p>
<pre><code>@echo off
XCOPY F:\test.bat D:\
IF ERRORLEVEL 1 (ECHO 文件拷贝失败
) Else IF ERRORLEVEL 0 ECHO 成功拷贝文件
pause</code></pre><p>很多DOS程序在运行结束后会返回一个数字值用来表示程序运行的结果(或者状态)，称为错误码errorlevel或称返回码。<br>常见的返回码为0、1。通过if errorlevel命令可以判断程序的返回值，根据不同的返回值来决定执行不同的命令。</p>
</li>
<li><p>else<br>语法： if 条件 (成立时执行的命令) else (不成立时执行的命令)<br>如果是多个条件，建议适当使用括号把各条件包起来，以免出错。</p>
<pre><code>if 1 == 0 ( echo comment1 ) else if 1==0 ( echo comment2 ) else (echo comment3 )</code></pre><p>注：如果 else 的语句需要换行，if 执行的行尾需用“^”连接，并且 if 执行的动作需用(括起来)，否则报错</p>
<pre><code>if 1 == 0 ( echo comment1 ) else if 1==0 ( echo comment2 ) ^
else (echo comment3 )</code></pre></li>
<li><p>比较运算符:<br>EQU - 等于   (一般使用“==”)<br>NEQ - 不等于 (没有 “!=”,改用“ if not 1==1 ”的写法)<br>LSS - 小于<br>LEQ - 小于或等于<br>GTR - 大于<br>GEQ - 大于或等于</p>
</li>
</ol>
</li>
<li><p>choice 命令<br>choice 使用此命令可以让用户输入一个字符(用于选择)，从而根据用户的选择返回不同的 errorlevel，<br>然后配合 if errorlevel 选择运行不同的命令。<br>注意：choice命令为DOS或者Windows系统提供的外部命令，不同版本的choice命令语法会稍有不同，请用choice /?查看用法。<br>choice 使用此命令可以让用户输入一个字符，从而运行不同的命令。<br>使用时应该加/c:参数，c:后应写提示可输入的字符，之间无空格。它的返回码为1234……</p>
<pre><code>choice /c:dme /m defrag,mem,end
if errorlevel 3 goto defrag (应先判断数值最高的错误码)
if errorlevel 2 goto mem
if errotlevel 1 goto end</code></pre></li>
<li><p>for命令<br>1)</p>
<pre><code>for {%variable | %%variable} in (set) do command [command-parameters]</code></pre><p>%variable 指定一个单一字母可替换的参数。<strong>变量名称是区分大小写的，所以 %i 不同于 %I</strong><br>在批处理文件中使用 FOR 命令时，指定变量建议用 %%variable而不要用 %variable。</p>
</li>
</ol>
<p> <strong>注意：</strong>在批处理文件中使用%%,命令行显示为%,命令行中要使用一个%,使用%%会报错<br> (set) 指定一个或一组文件。可以使用通配符。<br> command 指定对每个文件执行的命令。<br> command-parameters 为特定命令指定参数或命令行开关。</p>
<pre><code>rem 如下命令行会显示当前目录下所有以bat或者txt为扩展名的文件名。
for %%c in (*.bat *.txt) do (echo %%c)</code></pre><p> 2)<br> 如果命令扩展名被启用，下列额外的 FOR 命令格式会受到支持:</p>
<pre><code>FOR /D %variable IN (set) DO command [command-parameters]</code></pre><p> 如果set集里面包含通配符，则指定与目录名匹配，而不与文件名匹配。</p>
<pre><code>rem 如下命令行会显示当前目录下所有包含有 e 或者 i 的目录名。
for /D %%a in (*e* *i*) do echo %%a</code></pre> <br/>

<pre><code>FOR /R [[drive:]path] %variable IN (set) DO command [command-parameters]</code></pre><p> 检查以 [drive:]path 为根的目录树，指向每个目录中的FOR 语句。<br> 如果在 /R 后没有指定目录，则使用当前目录。如果集仅为一个单点(.)字符，则枚举该目录树。</p>
<pre><code>rem 如下命令行会显示 E盘test目录 下所有以bat或者txt为扩展名的文件名。
for /R E:\test %%b in (*.txt *.bat) do echo %%b
for /r %%c in (*) do (echo %%c)  :: 遍历当前目录下所有文件</code></pre> <br/>

<pre><code>FOR /L %variable IN (start,step,end) DO command [command-parameters]</code></pre><p> 该集表示以增量形式从开始到结束的一个数字序列。<br> 如：(1,1,5) 将产生序列 1 2 3 4 5；  而(5,-1,1) 将产生序列 (5 4 3 2 1)。</p>
<pre><code>rem 如下命令行将产生序列 1 2 3 4 5
for /L %%c in (1,1,5) do echo %%c</code></pre><p> 有或者没有 usebackq 选项:</p>
<pre><code>FOR /F [&quot;options&quot;] %variable IN (file-set) DO command
FOR /F [&quot;options&quot;] %variable IN (&quot;string&quot;) DO command
FOR /F [&quot;options&quot;] %variable IN (command)  DO command</code></pre><p> 参数”options”为:</p>
<pre><code>eol=c           - 指一个行注释字符的结尾(就一个,如“;”)
skip=n          - 指在文件开始时忽略的行数。
delims=xxx      - 指分隔符集。这个替换了空格和跳格键的默认分隔符集。
tokens=x,y,m-n  - 指每行的哪一个符号被传递到每个迭代的 for 本身。这会导致额外变量名称的分配。m-n格式为一个范围。如果符号字符串中的最后一个字符为星号，那么额外的变量将在最后一个符号解析之后分配并接受行的保留文本。
usebackq        - 指定新语法已在下类情况中使用:
                  在作为命令执行一个后引号的字符串并且一个单引号字符为文字字符串命令并允许在 filenameset中使用双引号扩起文件名称。</code></pre><p> 以下两句，显示当前的年月日和时间</p>
<pre><code>For /f &quot;tokens=1-3 delims=-/. &quot; %%j In (&apos;Date /T&apos;) do echo %%j年%%k月%%l日
For /f &quot;tokens=1,2 delims=: &quot; %%j In (&apos;TIME /T&apos;) do echo %%j时%%k分</code></pre><p> 把记事本中的内容每一行前面去掉8个字符</p>
<pre><code>setlocal enabledelayedexpansion
for /f %%i in (zhidian.txt) do (
set atmp=%%i
set atmp=!atmp:~8!
if {!atmp!}=={} ( echo.) else echo !atmp!
)
:: 读取记事本里的内容(使用delims 是为了把一行显示全,否则会以空格为分隔符)
for /f &quot;delims=&quot; %%a in (zhidian.txt) do echo.%%a</code></pre><p> 注：<br> setlocal enabledelayedexpansion开启扩展参数延迟，将在后面讲解。<br> ~8意思为从字符串的第8个字符开始截取，有关字符串截取在后面讲解。<br> 经过试验，注释部分会读取错误，截取纯文本没有问题，但是当截取含有特殊符号的文本时（比如本文中上面一段）并没有得到想要的结果，不知为何。<br> 3) continue 和 break<br> 利用 goto 实现程序中常用的 continue 和 break 命令, 其实非常简单<br> continue: 在 for 循环的最后一行写上一个标签，跳转到这位置即可<br> break: 在 for 循环的外面的下一句写上一个标签，跳转到这位置即可</p>
<pre><code>for /F [&quot;options&quot;] %variable IN (command)  DO (
... do command ...
if ... goto continue
if ... goto break
... do command ...
:continue
)
:break</code></pre></li>
</ol>
<h3 id="三、其它命令"><a href="#三、其它命令" class="headerlink" title="三、其它命令"></a>三、其它命令</h3><ol>
<li><p>ping 命令<br>测试网络联接状况以及信息包发送和接收状况。但是不能够测试端口。</p>
<pre><code>语法：ping IP地址或主机名 [-t] [-a] [-n count] [-l size]</code></pre><p>参数含义：</p>
</li>
</ol>
<p>-t 不停地向目标主机发送数据；<br>-a 以IP地址格式来显示目标主机的网络地址；<br>-n count 指定要Ping多少次，具体次数由count来指定；<br>-l size 指定发送到目标主机的数据包的大小。</p>
<pre><code>ping 192.168.0.1 -t (不停的测试192.168.0.1，按ctrl+c停止)
for /L %%a in (0,1,255) do ping 192.168.0.%%a -n 1 &gt;&gt; tmp.txt (ping一下所有的局域网电脑)</code></pre><ol start="2">
<li><p>telnet 命令<br>测试端口使用 telnet IP地址或主机名 端口，使用tcp协议的</p>
<pre><code>telnet 192.168.0.1 80 (测试192.168.0.1的80端口)</code></pre></li>
<li><p>color 命令<br>设置背景及字体颜色</p>
<pre><code>语法： color bf</code></pre><p>b 是指定背景色的十六进制数字； f 指定前景颜色(即字体颜色)。<br>颜色值:     0:黑色    1:蓝色    2:绿色    3:湖蓝    4:红色    5:紫色    6:黄色    7:白色 8:灰色    9:淡蓝    A:淡绿    B:浅绿    C:淡红    D:淡紫    E:淡黄    F:亮白<br>如果没有给定任何参数，该命令会将颜色还原到 CMD.EXE 启动时的颜色。<br>如果两参数一样，视为无效输入。只有一个参数时，设置字体。</p>
</li>
<li><p>random 命令<br>产生随机数(正整数0~)，要使用random，必须将其当作一个变量来使用，这样才能得到值。</p>
<pre><code>echo %random%</code></pre><p>%random%可以产生0到65535之间的随机数。<br>通过获得一定范围内的随机数：<br>通用的算法公式如： <code>%random%%%(max-min+1)+min来产生[min,max]区间里的随机数</code>注：批处理中求模得用两个%%符号。</p>
<pre><code>@REM 产生10个[4,12]间的随机数
@echo off
REM 启用延迟环境变量扩展
setlocal enabledelayedexpansion
REM 设置随机数的最小和最大值以及求模用的变量
set min=4
set max=12
set /a mod=!max!-!min!+1

for /l %%i in (1,1,10) do (
REM 产生[min,max]之间的随机数
set /a r=!random!%%!mod!+!min!
echo.
echo 随机数%%i：!r!
)</code></pre><p><a href="https://www.jb51.net/article/36489.htm">参考链接</a></p>
</li>
<li><p>exit 命令<br>结束程序。即时是被调用的程序，结束后也不会返回原程序</p>
</li>
<li><p>shutdown命令<br>shutdown -s 关机</p>
</li>
<li><p>所有内置命令的帮助信息<br>ver /?<br>cmd /?<br>set /?<br>rem /?<br>if /?<br>echo /?<br>goto /?<br>for /?<br>shift /?<br>call /?<br>其他需要的常用命令<br>type /?<br>find /?<br>findstr /?<br>copy /?</p>
</li>
</ol>
<h3 id="四、字符串处理"><a href="#四、字符串处理" class="headerlink" title="四、字符串处理"></a>四、字符串处理</h3><ol>
<li><p>分割字符串，以查看时间为例<br>%源字符串:~起始值,截取长度%  (起始值从0开始；截取长度是可选的，如果省略逗号和截取长度，将会从起始值截取到结尾；<br>截取长度如果是负数，表示截取到倒数第几个。)</p>
<pre><code>&quot;%time%&quot;  显示如：&quot;11:04:23.03&quot; (完整的时间&quot;hh:mm:ss.tt&quot;)
&quot;%time:~0,5%&quot; 显示&quot;hh:mm&quot;(即&quot;11:04&quot;)，其中0表示从右向左移位操作的个数，5表示从左向右移位操作的个数
&quot;%time:~0,8%&quot; 显示标准时间格式&quot;hh:mm:ss&quot;(即&quot;11:04:23&quot;，前8个字符串)
&quot;%time:~3,-3%&quot;显示&quot;mm:ss&quot;(即从第4个开始,截去最后3个的字符串)
&quot;%time:~3%&quot;   显示&quot;04:23.03&quot;(即去掉前4个字符串)
&quot;%time:~-3%&quot;  显示&quot;.tt&quot;(即最后3个字符串)</code></pre><p>上面的字串分割格式，也可以用于其它地方，如目录路径：”%cd:~0,10%”</p>
</li>
<li><p>替换字符串</p>
<pre><code>set a=&quot;abcd1234&quot;
echo %a%    显示：&quot;abcd1234&quot;
set a=%a:1=kk%  替换“1”为“kk”
echo %a%    显示：&quot;abcdkk234&quot;</code></pre></li>
<li><p>字符串合并</p>
<pre><code>set str1=%str1%%str2%    (合并 str1 和 str2)</code></pre></li>
<li><p>计算字符串长度<br>没有现成的函数。如下程序利用 goto形成循环，不断将字符串截短1，并记录截短的次数，到字符串变成空时的次数即长度。</p>
<pre><code>set testStr=This is a test string
:: 将 testStr 复制到str，str 是个临时字符串
set str=%testStr%
:: 标签，用于goto跳转
:next1
:: 判断str是不是空，如果不是则执行下边的语句
if not &quot;%str%&quot;==&quot;&quot; (
:: 算术运算，使num的值自增1，相当于num++或者++num语句
set /a num+=1
:: 截取字符串，每次截短1
set &quot;str=%str:~1%&quot;
:: 跳转到next1标签: 这里利用goto和标签，构成循环结构
goto next1
)
:: 当以上循环结构执行完毕时，会执行下边的语句
echo testStr=%testStr%
echo testStr的长度为：%num%</code></pre></li>
<li><p>截取字符串时，需要传递参数<br>直接 echo %args:~%num%,-5% 没办法想要的字符串，需要如下两步</p>
<pre><code>setlocal enabledelayedexpansion
echo !args:~%num%,-5!</code></pre></li>
</ol>
<h3 id="五、系统服务"><a href="#五、系统服务" class="headerlink" title="五、系统服务"></a>五、系统服务</h3><ol>
<li>停止服务：NET STOP 服务名<br>启动服务：NET Start 服务名</li>
<li>设置启动类型<br>自动：  SC CONFIG 服务名 START= auto<br>手动：  SC CONFIG 服务名 START= demand<br>已禁用：SC CONFIG 服务名 START= disabled<br>附：“START= ”等号后面必须要有一个空格。(start还有boot,system两个值)<br>Sample:  SC CONFIG Spooler START= demand (打印机加载项，设置成手动，默认自动)</li>
<li>查看系统服务：start %SystemRoot%\system32\services.msc /s</li>
</ol>
<h3 id="六、setlocal与变量延迟"><a href="#六、setlocal与变量延迟" class="headerlink" title="六、setlocal与变量延迟"></a>六、setlocal与变量延迟</h3><ol>
<li><p>批处理中setlocal enabledelayedexpansion的含义<br><a href="https://blog.csdn.net/kolamemo/article/details/18036021">参考链接</a><br>注意两点：</p>
<ol>
<li>什么叫环境变量扩展和延迟环境变量扩展</li>
<li>延迟的变量用！！表示</li>
</ol>
</li>
<li><p>启动批处理文件中环境变量的本地化。本地化将持续到出现匹配的 endlocal 命令或者到达批处理文件结尾为止。<br>语法:</p>
<pre><code>setlocal {enableextension | disableextensions} {enabledelayedexpansion | disabledelayedexpansion}</code></pre><p>enableextension: 启用命令扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。<br>disableextensions: 禁用命令扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。<br>enabledelayedexpansion: 启用延迟的环境变量扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。<br>disabledelayedexpansion: 禁用延迟的环境变量扩展，直到出现匹配的 endlocal 命令，无论 setlocal 命令之前的设置如何。</p>
</li>
</ol>
<h3 id="七、文件处理"><a href="#七、文件处理" class="headerlink" title="七、文件处理"></a>七、文件处理</h3><ol>
<li>删除<ul>
<li>删除一个文件或多个文件<br>del /s /q /f d:\test\a.bat<br>将直接删除d:\test\a.bat，没有任务提示<br>del temp* /q /f /s<br>将直接删除 本目录的 temp 目录的所有文件，没有任务提示<br>删除文件的时候可以使用“*”作通配符</li>
<li>删除一个空目录<br>rd /q /s  d:\test\log<br>将直接删除d:\test\log目录，如果log目录里面有文件将无法删除</li>
<li>删除一个非空目录 (必须指定目录名称)<br>rmdir /q /s d:\test\logs<br>必须指定目录名称，不能使用通配符<br>/S  除目录本身外，还将删除指定目录下的所有子目录<br>/Q  安静模式，带 /S 删除目录树时不要求确认<br>无论里面是否有文件或文件夹将全部直接删除</li>
</ul>
</li>
<li>创建目录<br>MKDIR [drive:]path<br>MD [drive:]path<br>路径有空格时，可以用双引号括起来，也可以用 &nbsp; 替代</li>
</ol>
<h2 id="实践部分"><a href="#实践部分" class="headerlink" title="实践部分"></a>实践部分</h2><h3 id="1-小摘录"><a href="#1-小摘录" class="headerlink" title="1.小摘录"></a>1.小摘录</h3><ol>
<li><p>调用其他程序时，对文件的大小写不敏感，文件后缀也可忽略<br>如：start LeapFTP.exe  与 start leapftp 效果一样，都是运行“LeapFTP.exe”文件</p>
</li>
<li><p>每行的开头的字符串会自动查找程序来运行，还可用双引号引起来(<strong>文件名或目录名含空格时必须用</strong>)<br>如：”D:\Program Files\Leap FTP.exe”<br>“LeapFTP.exe” 可正常运行文件（在原窗口）<br>start “标题” “LeapFTP.exe” start是在新窗口运行(第一个参数是窗口显示的标题)</p>
</li>
<li><p>copy C:\test*.* D:\back  (复制C盘test文件夹的所有文件(不包括文件夹及子文件夹里的东西)到D盘的back文件夹)</p>
</li>
<li><p>dir c:*.* &gt; a.txt　(将c盘文件列表写入 a.txt 中)</p>
</li>
<li><p><code>&gt;</code> 生成文件并写入内容(如果有这文件则覆盖)，  <code>&gt;&gt;</code> 文件里追加内容</p>
</li>
<li><p>md d:\aa (创建文件夹)</p>
</li>
<li><p>在命令末尾加上“&gt;NUL 2&gt;NUL”，表示隐蔽返回信息。</p>
</li>
<li><p>等待用户输入： set /p 变量名=屏幕显示信息。<br>set是对参数的定义，动态的话需要加上/p的条件，“=”后面的内容便是对这个参数的描述，在用户需要输入值得时候提示用户。</p>
<pre><code>set /p a=请输入a:
set /p b=请输入b:
echo %a%   %b%
pause&gt;nul</code></pre></li>
<li><p>让用户按回车退出<br>小技巧(替代pause)，文件的最后一句：set /p tmp=操作结束，请按回车键退出…</p>
</li>
<li><p>设置标题： title JDK安装</p>
</li>
<li><p>清屏： cls</p>
</li>
<li><p>修改文件的更新日期<br>copy 文件名+‘’&gt;nul  (修改为当前时间，如果要修改为指定时间，先修改系统时间，再改回系统时间)</p>
</li>
<li><p>修改文件的后缀名<br>ren C:\test*.jpg <em>.JPG<br>for /r %%c in (</em>.jpg) do (ren %%c *.JPG)  :: 修改当前目录下的所有文件的后缀名，包括子目录的</p>
</li>
<li><p>修改文件的文件名<br>rename test.jpg test2.JPG<br>rename *.jpg *.888.JPG</p>
</li>
<li><p>共享<br>A.查看你机器的共享资源: net share<br>B.手工删除共享<br>  net share 共享资源名称$ /d<br>  注意$后有空格。<br>C.增加一个共享：<br>  net share mymovie=e:\downloads\movie /users:3<br>  mymovie 共享成功。 同时限制链接用户数为3人。</p>
</li>
</ol>
<h3 id="实例收集"><a href="#实例收集" class="headerlink" title="实例收集"></a>实例收集</h3><ol>
<li><p>在批处理中使用密码。密码为admin，输入正确，跳转到next1 ，若输入密码错误3次，则锁屏。。</p>
<pre><code>@echo off
set num=0
:11
set /p pass=请输入密码:
if &quot;%pass%&quot;==&quot;admin&quot; goto next1
set /a num=%num% + 1
if %num%==3 goto no1
goto 11
:no1
%windir%\system32\rundll32.exe user32.dll,LockWorkStation
goto 11
:next1
echo 密码正确，执行下面的程式
pause</code></pre></li>
</ol>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><ol>
<li>部分命令直接在cmd窗口中运行不了，要写入.bat文件中运行</li>
<li>网上查询的或者实例中的命令运行不了，提示”XXX不是有效命令”。–原因是我把系统默认的记事本编辑器改为notepad了，用notpad编辑的bat文件，每行的头部少一些东西吧。当我重新建一个bat文件，用sublimetext打开编辑的时候，就好了（不要问我为何不用系统记事本233333~）。另外注意编码格式要选择GBK或者ANSI，否则会有中文乱码问题。</li>
</ol>
<p>参考链接：<br><a href="https://www.cnblogs.com/SunShineYPH/archive/2011/12/13/2285570.html">Bat命令学习</a></p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/bat%E5%91%BD%E4%BB%A4/">bat命令</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/10/29/tomat%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">tomat源码解析-启动过程（一）</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/10/08/tomcat%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"><span class="level-item">tomcat源码解析-类加载机制</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Kommentare</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "vdKGC2peyYNqLJP9zJe3AqHe-gzGzoHsz",
            appKey: "szUoRSxrU2ILylrufEgnWQTw",
            
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-Hans",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://s1.ax1x.com/2020/06/08/thQzdS.th.jpg" alt="Jacklon"></figure><p class="title is-size-4 is-block line-height-inherit">Jacklon</p><p class="is-size-6 is-block">非典型程序员一枚</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing,China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">24</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/jaclon-m" target="_blank" rel="noopener">Folgen</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/jaclon-m"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Katalog</h3><ul class="menu-list"><li><a class="is-flex" href="#基础部分"><span class="mr-2">1</span><span>基础部分</span></a><ul class="menu-list"><li><a class="is-flex" href="#一、介绍"><span class="mr-2">1.1</span><span>一、介绍</span></a></li><li><a class="is-flex" href="#二、参数"><span class="mr-2">1.2</span><span>二、参数</span></a></li><li><a class="is-flex" href="#三、其它命令"><span class="mr-2">1.3</span><span>三、其它命令</span></a></li><li><a class="is-flex" href="#四、字符串处理"><span class="mr-2">1.4</span><span>四、字符串处理</span></a></li><li><a class="is-flex" href="#五、系统服务"><span class="mr-2">1.5</span><span>五、系统服务</span></a></li><li><a class="is-flex" href="#六、setlocal与变量延迟"><span class="mr-2">1.6</span><span>六、setlocal与变量延迟</span></a></li><li><a class="is-flex" href="#七、文件处理"><span class="mr-2">1.7</span><span>七、文件处理</span></a></li></ul></li><li><a class="is-flex" href="#实践部分"><span class="mr-2">2</span><span>实践部分</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-小摘录"><span class="mr-2">2.1</span><span>1.小摘录</span></a></li><li><a class="is-flex" href="#实例收集"><span class="mr-2">2.2</span><span>实例收集</span></a></li><li><a class="is-flex" href="#坑"><span class="mr-2">2.3</span><span>坑</span></a></li></ul></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Jacklon&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2020 Jacklon</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/jaclon-m"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-Hans");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://59.110.153.50',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Tippen Sie etwas..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Tippen Sie etwas...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Kategorien","tags":"Tags"});
        });</script></body></html>